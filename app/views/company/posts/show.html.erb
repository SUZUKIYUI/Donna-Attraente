<!--企業投稿作品詳細画面-->

<div class="content_width post_show_back">
  <% @post.offers.each do |offer| %>
    <% if offer.established? %>
      <div class="post_show_established_text">
        <p><%= offer.company.company_name %><span>様により商品化が決定しました</span></p>
      </div>
    <% end %>
  <% end %>
  <div class="post_show_top">
    <div class="post_show_top_flex">
      <div class="post_show_top1">
        <%= attachment_image_tag @post, :post_image, :fill, 450, 650, class: "post_show_post_image" %>
      </div>
      <div class="post_show_top2">
        <%= link_to company_design_contributor_path(@post.design_contributor.id), class: "post_show_user" do %>
          <div class="post_show_user1">
            <%= attachment_image_tag @post.design_contributor, :profile_image, :fill, 200, 200, fallback: "no_image.png", size: "200x200", class: "post_show_profile_image" %>
          </div>
          <div class="post_show_user2">
            <%= @post.design_contributor.pen_name %>
          </div>
        <% end %>
        <div class="post_show_author_comment">
          <p>作者コメント</p>
          <div class="post_show_author_comment1">
            <%= @post.author_comment %>
          </div>
          <div class="post_show_created_at">
            <%= @post.created_at.strftime('%Y/%m/%d %H:%M') %><span>公開</span>
          </div>
        </div>
      </div>
    </div>
    <div class="post_show_top3">
      <div class="want_link">
        <p>なにこれ欲しい<span>☆</span></p>
        <p><span>★</span><%= @post.wants.count %></p>
      </div>
    </div>
  </div>

  <div class="post_show_bottom">
    <!-------------------コメント一覧-------------------->
    <p class="post_show_comment_heading">コメント一覧</p>
    <div class="post_show_bottom_content">
      <div class="post_show_bottom_left company_post_show_bottom_left">
        <% if Comment.exists?(post_id: @post.id) %>
          <% @post.comments.each do |comment| %>
            <div class="post_show_comment_box">
              <div class="post_show_comment_user">
                <%= link_to company_design_contributor_path(comment.design_contributor_id), class: "post_show_comment_user_link" do %>
                  <div class="post_show_comment_user2">
                    <%= attachment_image_tag comment.design_contributor, :profile_image, :fill, 50, 50, fallback: "no_image.png", size: "50x50", class: "post_show_comment_user1" %>
                  </div>
                  <div class="post_show_comment_user2">
                    <% if comment.design_contributor.id == @post.design_contributor.id %>
                      <p>投稿者</p>
                    <% else %>
                      <p><%= comment.design_contributor.pen_name %></p>
                    <% end %>
                  </div>
                <% end %>
              </div>
              <div class="post_show_comment">
                <div class="post_show_comment1">
                  <%= comment.comment %>
                </div>
                <div class="post_show_comment2">
                  <%= comment.created_at.strftime('%Y/%m/%d %H:%M') %>
                </div>
              </div>
            </div>
          <% end %>
        <% else %>
          <p class="post_show_no_comment">コメントはまだありません</p>
        <% end %>
      </div>
      <!----------------------------------------->
      <div class="post_show_bottom_right company_post_show_bottom_right">
        <div class="company_post_show_bottom_right1">
          <!---------------------作品への反応----------------------->
          <div class="post_show_reaction company_post_show_reaction">
            <p class="post_show_reaction_heading">このデザインへの反応</p>
            <div class="post_show_reaction_content post_show_reaction_want">
              <p>なにこれ欲しい☆</p>
              <div>
                <span><%= @post.wants.count %></span>★
              </div>
            </div>
            <div class="post_show_reaction_content post_show_reaction_comment">
              <p>コメント</p>
              <div>
                <span><%= @post.comments.count %></span>件
              </div>
            </div>
            <!--オファーモデルは存在するか-->
            <% if @post.offered_by? %>
              <!--------交渉中のオファーが存在するか--------->
              <% if @post.offered_negotiation_by?(@post.id) %>
                <div class="post_show_reaction_content">
                  <p>オファー</p>
                  <p>現在交渉中</p>
                </div>
              <!----------交渉成立オファーあれば表示------------>
              <% elsif @post.offered_established_by?(@post.id) %>
                <% if @offer.company == current_company %>
                  <div class="post_show_reaction_content">
                    <p>オファー</p>
                    <p>交渉成立</p>
                  </div>
                <% else %>
                  <div class="post_show_reaction_content">
                    <p>オファー</p>
                    <p>他社と交渉成立済</p>
                  </div>
                <% end %>
              <!---------交渉不成立オファーあれば表示-------->
              <% elsif @post.offered_failure_by?(@post.id) %>
                <div class="post_show_reaction_content">
                  <p>オファー</p>
                  <p>交渉不成立<span><%= Offer.where(post_id: @post.id, offer_status: :failure).count %></span>件</p>
                </div>
                <p class="post_offer_announce1">現在オファー受付中です</p>
              <!--オファーモデルは存在するがこのデザインにオファーが来ていない-->
              <% else %>
                <div class="post_show_reaction_content">
                  <p>オファー</p>
                  <p><span>0</span>件</p>
                </div>
                <p class="post_offer_announce1">現在オファー受付中です</p>
              <% end %>
            <!-------オファーモデルが存在しない------>
            <% else %>
              <div class="post_show_reaction_content">
                <p>オファー</p>
                <p><span>0</span>件</p>
              </div>
              <p class="post_offer_announce1">現在オファー受付中です</p>
            <% end %>
          </div>
          <!------------------------>
          <% if @post.offered_by? %>
            <% if @post.offered_negotiation_by?(@post.id) %>
              <% if @offer.company == current_company %>
                <p class="post_offer_announce2">現在交渉しております。<br /><%= @post.design_contributor.pen_name %>様の返信をお待ちください。</p>
              <% else %>
                <p class="post_offer_announce2">現在<span><%= @offer.company.company_name %></span>様が<br />商品化の交渉を行なっております。</p>
                <p class="company_post_show_call">※交渉不成立となった場合、<br />再度こちらのページからオファーが可能です</p>
              <% end %>
            <% elsif @post.offered_established_by?(@post.id) %>
              <% if @offer.company == current_company %>
                <p class="post_offer_announce2"><%= @post.design_contributor.pen_name %>様が<br />商品化を承諾しました</p>
              <% else %>
                <p class="post_offer_announce2"><%= @offer.company.company_name %>様と契約済</p>
                <p class="company_post_show_call">商品化が決定した為、<br />こちらのデザインへはオファーができません<br />新たなデザインをお探しください</p>
              <% end %>
            <% else %>
              <%= link_to new_company_post_offer_path(@post.id), class: "post_offer_announce2 offer_new_link1" do %>
                <p class="offer_new_link2">商品化の<br />オファーを送る</p>
              <% end %>
              <p class="company_post_show_call">ステキなデザインを見つけたら<br />ぜひ商品化のオファーを送ってください♪</p>
            <% end %>
          <% else %>
            <%= link_to new_company_post_offer_path(@post.id), class: "post_offer_announce2 offer_new_link1" do %>
              <p class="offer_new_link2">商品化の<br />オファーを送る</p>
            <% end %>
            <p class="company_post_show_call">ステキなデザインを見つけたら<br />ぜひ商品化のオファーを送ってください♪</p>
          <% end %>
        </div>
        <div class="post_index_link1 company_post_show_bottom_right2">
          <%= link_to "デザイン一覧に戻る", company_posts_path, class: "post_index_link2" %>
        </div>
        <div class="company_post_index_link_decoration"></div>
      </div>
    </div>
  </div>
</div>